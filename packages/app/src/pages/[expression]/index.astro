---
import BaseLayout from '../../layouts/BaseLayout.astro';

import json from '../../static/items.json';
import { filterCategorizedCollectionsByTime } from '../../helpers/collections';
import { CategoryDirectories } from '../../components/Directories';
import {
  HOME_SINCE_BREADCRUMBS,
  HOME_UNTIL_BREADCRUMBS
} from '../../helpers/paths';

const { items, date } = json;

export async function getStaticPaths() {
  const expressions = ['since', 'until'];
  const paths = [];

  for (const expression of expressions) {
    const collectionsByTime = filterCategorizedCollectionsByTime(
      items,
      new Date(),
      expression
    );
    const isSince = expression === 'since';

    for (const item of collectionsByTime) {
      paths.push({
        params: {
          expression
        },
        props: {
          expression,
          breadcrumbs: isSince
            ? HOME_SINCE_BREADCRUMBS
            : HOME_UNTIL_BREADCRUMBS,
          title: isSince
            ? 'Collections by Time: Since'
            : 'Collections by Time: Until',
          collections: collectionsByTime
        }
      });
    }
  }

  return paths;
}

const { title, expression, collections, breadcrumbs } = Astro.props;
const TITLE_CARD_PREFIXES = { expression: true, parentTitle: true };
---

<BaseLayout
  pages={breadcrumbs}
  {title}
  description={`The ${title} time category page in imballinst's events tracker site.`}
>
  <!-- TODO(imballinst): add client:visible because we're using React hooks. Not possible atm with the Date bug. -->
  <CategoryDirectories
    updateDate={date}
    items={collections}
    {title}
    viewAllSlugPrefix={expression}
    titleCardPrefixes={TITLE_CARD_PREFIXES}
  />
</BaseLayout>
